<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Certified ID Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body style="font-family: Arial, sans-serif; text-align: center; padding: 20px;">

  <h2>Certified ID PDF Generator</h2>

  <input type="file" id="imageUpload" accept="image/*"><br><br>
  <label>Select Date: </label>
  <input type="date" id="dateInput"><br><br>
  <button onclick="generatePDF()">Download PDF</button>

  <script>
    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      const fileInput = document.getElementById("imageUpload").files[0];
      const dateValue = document.getElementById("dateInput").value;

      if (!fileInput || !dateValue) {
        alert("Please upload an image and select a date.");
        return;
      }

      // Format date for filename (YYYY.MM.DD)
      const date = new Date(dateValue);
      const formattedFileDate = `${date.getFullYear()}.${String(date.getMonth()+1).padStart(2,'0')}.${String(date.getDate()).padStart(2,'0')}`;
      // Format date for certification text (DD/MM/YYYY)
      const formattedTextDate = `${String(date.getDate()).padStart(2,'0')}/${String(date.getMonth()+1).padStart(2,'0')}/${date.getFullYear()}`;

      const pdfName = `5. ${formattedFileDate} Certified ID.pdf`;

      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          const doc = new jsPDF();
          const pageWidth = doc.internal.pageSize.getWidth();
          const pageHeight = doc.internal.pageSize.getHeight();

          // Max allowed size
          const maxWidth = pageWidth - 30;
          const maxHeight = pageHeight / 2;

          // Scale preserving aspect ratio
          let imgWidth = img.naturalWidth;
          let imgHeight = img.naturalHeight;
          const ratio = Math.min(maxWidth / imgWidth, maxHeight / imgHeight);

          imgWidth *= ratio;
          imgHeight *= ratio;

          // Center image
          const x = (pageWidth - imgWidth) / 2;
          const y = 20;

          // Detect format
          const format = fileInput.type.includes("png") ? "PNG" : "JPEG";

          // Add image with forced rotation 0
          doc.addImage(img, format, x, y, imgWidth, imgHeight, null, "FAST", 0);

          // Text below image
          doc.setFont("times", "normal"); // closest to Bookman Old Style
          doc.setFontSize(12);

          const certText = `${formattedTextDate}

I hereby certify this to be a true and correct copy of the original document.


Brendan Oakes
Level 5, Nexus Building, 4 Columbia Crt, Norwest NSW 2153
0410 558 706
AR 263573
Sentry Advice AFSL 227748`;

          const lines = certText.split("\n");
          let yText = y + imgHeight + 20;
          lines.forEach(line => {
            doc.text(line, pageWidth / 2, yText, { align: "center" });
            yText += 8;
          });

          doc.save(pdfName);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(fileInput);
    }
  </script>
</body>
</html>
